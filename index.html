<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SICAP Campus Virtual</title>
    
    <!-- FUENTES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- ESTILOS -->
    <link rel="stylesheet" href="css/estil.css?v=22.0">
    <link rel="icon" href="img/favicon.png" type="image/png">
</head>
<body>

    <!-- =========================
         1. LOGIN & REGISTRO
         ========================= -->
    <div id="login-overlay" class="login-wrapper">
        <div class="login-card">
            <div class="login-header">
                <img src="img/logo-sicap.png" alt="SICAP Logo" class="login-logo">
            </div>
            
            <div id="login-error-msg" class="login-error" style="display: none;">DNI no trobat o no actiu.</div>

            <!-- VISTA LOGIN -->
            <div id="login-view">
                <form id="login-form">
                    <div class="input-group">
                        <input type="text" id="login-dni" placeholder="Introdueix el teu DNI/NIF" required autocomplete="username" maxlength="9">
                    </div>
                    <div class="input-group">
                        <input type="password" id="login-pass" placeholder="Contrasenya" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn-login">Inicia la sessió</button>
                </form>
                <div class="login-footer"><a href="#" id="forgot-pass">Heu oblidat la contrasenya?</a></div>
                <div class="register-section">
                    <p>Ets afiliat i és la teva primera vegada?</p>
                    <button id="btn-show-register" class="btn-secondary">Registra't aquí</button>
                </div>
            </div>

            <!-- VISTA REGISTRO -->
            <div id="register-view" style="display: none;">
                <h3 style="color:var(--brand-blue); margin-bottom:15px;">Activació de Compte</h3>
                <p style="font-size:0.9rem; color:#666; margin-bottom:20px;">
                    Introdueix el teu DNI per verificar la teva afiliació i crea una contrasenya.
                </p>
                <form id="register-form">
                    <div class="input-group">
                        <input type="text" id="reg-dni" placeholder="El teu DNI/NIF" required autocomplete="username" maxlength="9">
                    </div>
                    <div class="input-group">
                        <input type="password" id="reg-pass" placeholder="Crea una contrasenya" required autocomplete="new-password">
                    </div>
                    <div class="input-group">
                        <input type="password" id="reg-pass-conf" placeholder="Repeteix la contrasenya" required autocomplete="new-password">
                    </div>
                    <button type="submit" class="btn-login" style="background-color: var(--brand-red) !important;">Validar i Entrar</button>
                </form>
                <div style="margin-top: 20px;">
                    <button id="btn-show-login" class="btn-secondary" style="border:none !important; text-decoration:underline;">
                        <i class="fa-solid fa-arrow-left"></i> Tornar al Login
                    </button>
                </div>
            </div>
            <div class="cookie-notice"><small>Avís de galetes: Utilitzem galetes pròpies per gestionar la sessió.</small></div>
        </div>
    </div>

    <!-- =========================
         2. APP PRINCIPAL
         ========================= -->
    <div id="app-container" style="display: none;">
        
        <header class="main-header">
            <div class="header-content">
                <div class="header-left-group">
                    <button id="mobile-menu-btn" class="mobile-menu-btn"><i class="fa-solid fa-bars"></i></button>
                    <img src="img/logo-sicap.png" alt="SICAP Campus" class="header-logo">
                    <nav class="header-nav" id="main-nav">
                        <a href="#" id="nav-catalog" class="nav-link">Pàgina Principal</a>
                        <a href="#" id="nav-profile" class="nav-link">Àrea personal</a>
                        <a href="#" id="nav-dashboard" class="nav-link active">Els meus cursos</a>
                    </nav>
                </div>
        
                <div class="header-right">
                    <button id="theme-toggle" class="btn-icon" title="Canviar Tema"><i class="fa-solid fa-moon"></i></button>
                    <div class="icon-wrapper" id="btn-notifs"><i class="fa-regular fa-bell"></i><span class="notification-dot"></span></div>
                    <div class="icon-wrapper" id="btn-messages"><i class="fa-regular fa-comment"></i></div>
                    <div class="header-divider"></div>
                    <div class="user-profile-container" id="user-menu-trigger">
                        <div class="user-avatar-circle" id="user-initials">US</div>
                        <i class="fa-solid fa-chevron-down desktop-arrow" style="font-size: 0.8rem; color: #666; margin-left: 5px;"></i>
                        <div class="user-dropdown" id="user-dropdown-menu">
                            <div class="dropdown-header">
                                <strong id="dropdown-username">Usuari</strong>
                                <small id="dropdown-email">email@test.com</small>
                            </div>
                            <ul>
                                <li><a href="#" data-action="profile"><i class="fa-regular fa-user"></i> Perfil</a></li>
                                <li><a href="#" data-action="grades"><i class="fa-solid fa-chart-bar"></i> Qualificacions</a></li>
                                <li class="divider"></li>
                                <li><a href="#" id="btn-logout-dropdown" style="color:var(--brand-red);"><i class="fa-solid fa-power-off"></i> Sortir</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- VISTAS -->
        <div id="dashboard-view" class="container-dashboard">
            <div class="dashboard-card">
                <h1>Els meus Cursos</h1>
                <div id="courses-list" class="courses-grid"></div>
            </div>
        </div>

        <div id="catalog-view" class="container-dashboard" style="display: none;">
            <div class="dashboard-card">
                <h1>Catàleg de Formació</h1>
                <p style="color:var(--text-secondary); margin-bottom:20px;">Tots els cursos disponibles al sindicat.</p>
                <div id="catalog-list" class="courses-grid"></div>
            </div>
        </div>

        <div id="profile-view" class="container-dashboard" style="display: none;">
            <div class="dashboard-card">
                <h1 style="border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px;">La meva Fitxa d'Afiliat</h1>
                <div class="profile-grid-layout">
                    <div class="profile-sidebar-card">
                        <div class="user-avatar-big" id="profile-avatar-big">US</div>
                        <h3 id="profile-name-display">Carregant...</h3>
                        <span class="badge-role">Afiliat Actiu</span>
                        <p style="font-size:0.9rem; color:#666; margin-top:10px;">DNI: <span id="profile-dni-display">...</span></p>
                        <div id="profile-stats-container" class="profile-stats-box" style="display:none;">
                            <div class="stat-row"><span><i class="fa-solid fa-graduation-cap"></i> Cursos Iniciats:</span><strong id="stat-started">0</strong></div>
                            <div class="stat-row"><span><i class="fa-solid fa-check-circle"></i> Completats:</span><strong id="stat-finished">0</strong></div>
                            <div class="stat-divider"></div>
                            <div class="stat-row"><span><i class="fa-regular fa-clock"></i> Hores Totals:</span><strong id="stat-hours">0h</strong></div>
                        </div>
                    </div>

                    <div class="profile-data-form">
                        <div class="form-grid-2">
                            <div class="input-group"><label>Telèfon Mòbil</label><input type="text" id="prof-movil" disabled></div>
                            <div class="input-group"><label>Email</label><input type="text" id="prof-email" disabled></div>
                            <div class="input-group"><label>Província</label><input type="text" id="prof-prov" disabled></div>
                            <div class="input-group"><label>Població</label><input type="text" id="prof-pob" disabled></div>
                            <div class="input-group"><label>Centre de Treball</label><input type="text" id="prof-centre" disabled></div>
                            <div class="input-group"><label>Categoria</label><input type="text" id="prof-cat" disabled></div>
                            <div class="input-group span-2"><label>Adreça Completa</label><input type="text" id="prof-dir" disabled></div>
                            <div class="input-group span-2"><label>IBAN</label><input type="text" id="prof-iban" disabled></div>
                        </div>
                        <div class="alert-info" style="margin-top:20px; background:var(--quiz-question-bg); padding:15px; border-radius:6px; font-size:0.9rem; border:1px solid var(--border-color);">
                            <i class="fa-solid fa-circle-info"></i> <strong>Nota:</strong> Per seguretat, les dades personals es gestionen des de secretaria.
                        </div>
                        <button class="btn-primary" onclick="window.location.href='mailto:secretaria@sicap.cat'" style="width:auto; margin-top:15px;">Sol·licitar canvi de dades</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="grades-view" class="container-dashboard" style="display: none;">
            <div class="dashboard-card">
                <h1>Qualificacions</h1>
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="border-bottom: 2px solid var(--brand-blue); text-align: left;">
                            <th style="padding: 10px;">Curs</th><th style="padding: 10px;">Estat</th><th style="padding: 10px;">Nota</th><th style="padding: 10px;">Diploma</th>
                        </tr>
                    </thead>
                    <tbody id="grades-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- VISTA EXAMEN -->
        <div id="exam-view" class="app-container" style="display: none;">
            <aside class="sidebar-left">
                <div class="sidebar-header"><h3>Índex del Curs</h3></div>
                <div id="course-index"></div>
                <div style="margin-top:20px;">
                    <a href="#" onclick="window.tornarAlDashboard(); return false;" class="btn-small">
                        <i class="fa-solid fa-arrow-left"></i> Tornar als Cursos
                    </a>
                </div>
            </aside>
            <main class="main-content">
                <div class="exam-card">
                    <h2 id="curs-titol">Carregant curs...</h2>
                    <div id="moduls-container">
                        <div class="loader"></div>
                        <p class="loading-text">Carregant contingut...</p>
                    </div>
                </div>
            </main>
            <aside class="sidebar-right">
                <div class="sidebar-header"><h3>Navegació</h3></div>
                <div id="quiz-grid" class="grid-container"></div>
                <div id="final-score-card" style="display: none;"></div>
            </aside>
        </div>
    </div>

    <!-- =========================
         FOOTER (3 COLUMNAS)
         ========================= -->
    <footer class="main-footer" style="display: none;" id="app-footer">
        <div class="footer-content">
            <div class="footer-logo">
                <img src="img/logo-sicap.png" alt="SICAP Logo">
                <p>&copy; 2025 SICAP. Tots els drets reservats.</p>
                <p>Carrer Malats, 27 | 08030 Barcelona</p>
            </div>

            <div class="footer-links">
                <a href="#" onclick="document.getElementById('modal-avis').style.display='flex'; return false;">Avís Legal</a>
                <span>|</span>
                <a href="#" onclick="document.getElementById('modal-privacitat').style.display='flex'; return false;">Política de Privacitat</a>
                <span>|</span>
                <a href="#" onclick="document.getElementById('modal-cookies').style.display='flex'; return false;">Política de Cookies</a>
                <span>|</span>
                <a href="mailto:sicap@sicap.cat">Contacte</a>
            </div>

            <div class="footer-social">
                <a href="https://sicap.cat" target="_blank" title="Web Oficial SICAP">
                    <i class="fa-solid fa-globe"></i> sicap.cat
                </a>
            </div>
        </div>
    </footer>

    <!-- =========================
         MODALES LEGALES (TEXTOS COMPLETOS RESTAURADOS)
         ========================= -->

    <!-- 1. MODAL AVÍS LEGAL -->
    <div id="modal-avis" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <h3 style="color:var(--brand-blue); border-bottom:1px solid #eee; padding-bottom:10px;">Avís Legal</h3>
            <div class="legal-text-content">
                <h4>1. Titularitat</h4>
                <p>Aquest portal d'Internet és titularitat de <strong>SINDICAT CATALÀ DE PRESONS (SICAP)</strong>.<br>
                CIF G22580633.<br>
                Domicili: carrer Malats, 27, 08030 Barcelona.<br>
                Tel. 933 426 810.<br>
                E-mail: sicap@sicap.cat</p>

                <h4>2. Objectiu</h4>
                <p>Aquest document té per objecte regular l'ús del web que SICAP posa a disposició del públic. La utilització del web per un tercer li atribueix la condició d'usuari, i suposa l'acceptació plena de l'usuari de totes i cada una de les condicions que estableix aquest Avís legal.</p>

                <h4>3. Ús correcte de la pàgina web</h4>
                <p>L'accés a aquest portal implica acceptar i conèixer les condicions i termes d'aquest Avís legal.</p>
                <p>L'usuari no podrà destruir, alterar, inutilitzar o, de qualsevol altra forma, fer malbé les dades, els programes o els documents electrònics.</p>

                <h4>4. Propietat intel·lectual i industrial</h4>
                <p>Aquest web i els seus continguts són propietat de SICAP o de tercers que l'han autoritzada per al seu ús.</p>

                <h4>5. Responsabilitat</h4>
                <p>SICAP no es fa responsable dels danys o perjudicis que es puguin produir pel mal ús d'aquest web per part de l'usuari o tercers.</p>
            </div>
            <div style="text-align: right; margin-top:15px;">
                <button class="btn-primary" onclick="document.getElementById('modal-avis').style.display='none'" style="width:auto;">Tancar</button>
            </div>
        </div>
    </div>

    <!-- 2. MODAL POLÍTICA DE PRIVACITAT -->
    <div id="modal-privacitat" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <h3 style="color:var(--brand-blue); border-bottom:1px solid #eee; padding-bottom:10px;">Política de Privacitat</h3>
            <div class="legal-text-content">
                <p>D'acord amb l'establert en el Reglament General de Protecció de Dades (RGPD), des de SINDICAT CATALÀ DE PRESONS (SICAP) li informem que les dades personals són tractades amb estricte compliment amb les normes vigents.</p>
                
                <h4>Identitat del Responsable del Tractament:</h4>
                <p>SINDICAT CATALÀ DE PRESONS (SICAP) CIF G22580633<br>
                Domicili: c/ Malats, 27, 08030 Barcelona.<br>
                E-mail: sicap@sicap.cat</p>

                <h4>Finalitat i temps de conservació</h4>
                <p>Tractem la informació que ens faciliten les persones interessades amb la finalitat de gestió administrativa, fiscal i de defensa jurídica als afiliats del sindicat. Les dades es conservaran mentre es mantingui la relació o durant els anys necessaris per complir amb les obligacions legals.</p>

                <h4>Drets dels usuaris</h4>
                <p>Tota persona té dret a obtenir confirmació sobre si a SICAP estem tractant dades personals que els concerneixin, així com a accedir a les seves dades personals, sol·licitar la rectificació de les dades inexactes o, en el seu cas, sol·licitar la seva supressió.</p>
            </div>
            <div style="text-align: right; margin-top:15px;">
                <button class="btn-primary" onclick="document.getElementById('modal-privacitat').style.display='none'" style="width:auto;">Tancar</button>
            </div>
        </div>
    </div>

    <!-- 3. MODAL POLÍTICA DE COOKIES -->
    <div id="modal-cookies" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <h3 style="color:var(--brand-blue); border-bottom:1px solid #eee; padding-bottom:10px;">Política de Cookies</h3>
            <div class="legal-text-content">
                <h4>Què són les cookies?</h4>
                <p>Una cookie és un arxiu que es descarrega en el seu ordinador en accedir a determinades pàgines web. Les cookies permeten a una pàgina web, entre altres coses, emmagatzemar i recuperar informació sobre els hàbits de navegació d'un usuari.</p>

                <h4>Tipus de cookies utilitzades</h4>
                <ul>
                    <li><strong>Cookies tècniques:</strong> Necessàries per a la navegació i el bon funcionament de la nostra pàgina web (gestió de sessió).</li>
                    <li><strong>Cookies de sessió:</strong> Dissenyades per a demanar i emmagatzemar dades mentre l'usuari accedeix a una pàgina web.</li>
                </ul>
                <p>Vostè pot permetre, bloquejar o eliminar les cookies instal·lades en el seu equip mitjançant la configuració de les opcions del navegador instal·lat al seu ordinador.</p>
            </div>
            <div style="text-align: right; margin-top:15px;">
                <button class="btn-primary" onclick="document.getElementById('modal-cookies').style.display='none'" style="width:auto;">Tancar</button>
            </div>
        </div>
    </div>

    <!-- CONFIRMACIÓ GENÈRICA (MODAL) -->
    <div id="custom-modal" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <div class="modal-icon"><i class="fa-solid fa-circle-question"></i></div>
            <h3 id="modal-title">Confirmació</h3>
            <div id="modal-msg">Estàs segur?</div>
            <div class="modal-actions">
                <button id="modal-btn-cancel" class="btn-secondary">Cancel·lar</button>
                <button id="modal-btn-confirm" class="btn-primary">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        (function() { const savedTheme = localStorage.getItem('theme'); if(savedTheme) document.documentElement.setAttribute('data-theme', savedTheme); })();
    </script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/dashboard.js?v=22.0"></script>
    <script src="js/renderitzadorCurs.js?v=10.0"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('slug')) { document.getElementById('dashboard-view').style.display = 'none'; document.getElementById('exam-view').style.display = 'flex'; }
            const themeBtn = document.getElementById('theme-toggle'); const icon = themeBtn.querySelector('i');
            const current = localStorage.getItem('theme'); icon.className = current === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
            themeBtn.addEventListener('click', () => {
                const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                const next = isDark ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', next); localStorage.setItem('theme', next);
                icon.className = next === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
            });
        });
    </script>
</body>
</html>